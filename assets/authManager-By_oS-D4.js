(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&n(i)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const g={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};class h{constructor(){this.config=this.getDefaultConfig(),this.loaded=!1}getDefaultConfig(){return{GOOGLE_CLIENT_ID:void 0,GOOGLE_ANALYTICS_ID:void 0,API_BASE_URL:"http://localhost:3000/api",ENVIRONMENT:"development",DEBUG_MODE:!0,LOG_LEVEL:"debug"}}detectEnvironment(){if(typeof window>"u")return"development";const e=window.location.hostname;return e.includes("staging")?"staging":e==="bingo.string.sg"?"production":"development"}async loadConfig(){if(this.loaded)return this.config;try{const e=this.detectEnvironment();if(console.log(`üîß Detected environment: ${e}`),e==="development"){const o=(s,i=void 0)=>typeof import.meta<"u"&&g&&g[s]||i;return this.config={...this.config,GOOGLE_CLIENT_ID:o("VITE_GOOGLE_CLIENT_ID"),GOOGLE_ANALYTICS_ID:o("VITE_GOOGLE_ANALYTICS_ID"),API_BASE_URL:o("VITE_API_BASE_URL","/api"),ENVIRONMENT:"development"},this.loaded=!0,console.log("‚úÖ Using development configuration"),this.config}console.log(`üîß Fetching config for ${e}...`);const t=await fetch(`/config-${e}.json`);if(!t.ok)throw new Error(`Failed to load config for ${e}: ${t.status}`);const n=await t.json();console.log("üìã Runtime config loaded:",n),this.config={...this.config,GOOGLE_CLIENT_ID:n.googleClientId,GOOGLE_ANALYTICS_ID:n.googleAnalyticsId,API_BASE_URL:n.apiBaseUrl,ENVIRONMENT:n.environment,DEBUG_MODE:n.debugMode,LOG_LEVEL:n.logLevel},this.loaded=!0,console.log(`‚úÖ Loaded ${e} configuration`)}catch(e){console.warn("‚ö†Ô∏è Failed to load runtime config, using defaults:",e)}return this.config}get(e){return this.config[e]}}const l=new h,m=()=>l.loadConfig(),r={get GOOGLE_CLIENT_ID(){return l.get("GOOGLE_CLIENT_ID")},get GOOGLE_ANALYTICS_ID(){return l.get("GOOGLE_ANALYTICS_ID")},get API_BASE_URL(){return l.get("API_BASE_URL")},SESSION_TIMEOUT:24*60*60*1e3,CAMERA:{width:{ideal:1280},height:{ideal:720},facingMode:"environment"},ZOOM:{min:.5,max:3,step:.1},GRID:{size:3,get centerIndex(){return Math.floor(this.size*this.size/2)}},ANIMATION:{fast:200,medium:300,slow:500},CHALLENGE_FILE:"/2025_1125stringwrap.csv"};class f{constructor(){this.user=null,this.isAuthenticated=!1,this.googleAuth=null,this.clientId=null,this.init()}async init(){try{console.log("üîß AuthManager: Loading configuration...");const e=await m();this.clientId=e.GOOGLE_CLIENT_ID,console.log("üîß AuthManager: Client ID loaded:",this.clientId),await this.waitForGoogleAuth(),await this.initializeGoogleAuth(),this.loadStoredSession()}catch(e){console.error("Failed to initialize auth:",e)}}waitForGoogleAuth(){return new Promise((e,t)=>{var i,a;if((a=(i=window.google)==null?void 0:i.accounts)!=null&&a.id){e();return}let n=0;const o=50,s=()=>{var c,u;n++,(u=(c=window.google)==null?void 0:c.accounts)!=null&&u.id?e():n>=o?t(new Error("Google Identity Services failed to load")):setTimeout(s,100)};s()})}async initializeGoogleAuth(){if(console.log("üîß Initializing Google Auth with Client ID:",this.clientId),!this.clientId||this.clientId==="YOUR_GOOGLE_CLIENT_ID_HERE"){console.error("‚ùå Google Client ID not configured. Current value:",this.clientId),console.error("‚ùå CONFIG object:",r);return}window.google.accounts.id.initialize({client_id:this.clientId,callback:this.handleGoogleResponse.bind(this),auto_select:!1,cancel_on_tap_outside:!0}),this.renderSignInButton()}renderSignInButton(){const e=document.getElementById("googleSignInBtn");e&&window.google.accounts.id.renderButton(e,{theme:"outline",size:"large",text:"signin_with",width:300})}handleGoogleResponse(e){try{const t=this.parseJWT(e.credential);this.user={id:t.sub,email:t.email,name:t.name,picture:t.picture,token:e.credential},this.isAuthenticated=!0,this.storeSession(),this.updateUI(),this.closeAuthModal(),window.location.pathname.includes("new.html")||this.redirectToAdmin(),typeof gtag<"u"&&gtag("event","login",{event_category:"engagement",event_label:"google_oauth",value:1})}catch(t){console.error("Failed to handle Google response:",t),this.showError("Login failed. Please try again.")}}parseJWT(e){try{const n=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(n).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(o)}catch{throw new Error("Invalid token format")}}storeSession(){this.user&&localStorage.setItem("bingoAuth",JSON.stringify({user:this.user,timestamp:Date.now()}))}loadStoredSession(){try{console.log("üîß AuthManager: Loading stored session...");const e=localStorage.getItem("bingoAuth");if(e){const t=JSON.parse(e);console.log("üîß AuthManager: Found stored session",t),Date.now()-t.timestamp<r.SESSION_TIMEOUT?(this.user=t.user,this.isAuthenticated=!0,console.log("üîß AuthManager: Session restored, user:",this.user.email),this.updateUI()):(console.log("üîß AuthManager: Session expired"),this.logout())}else console.log("üîß AuthManager: No stored session found")}catch(e){console.error("Failed to load stored session:",e),this.logout()}}logout(){this.user=null,this.isAuthenticated=!1,localStorage.removeItem("bingoAuth"),this.updateUI(),typeof gtag<"u"&&gtag("event","logout",{event_category:"engagement",event_label:"manual",value:1})}updateUI(){const e=document.getElementById("authBtn"),t=document.getElementById("makeYourOwnBtn"),n=document.getElementById("userInfo"),o=document.getElementById("userName"),s=document.getElementById("userAvatar");this.isAuthenticated&&this.user?(e&&(e.style.display="none"),t&&(t.style.display="inline-block"),n&&(n.style.display="block"),o&&(o.textContent=this.user.name),s&&(s.src=this.user.picture)):(e&&(e.style.display="inline-block"),t&&(t.style.display="none"),n&&(n.style.display="none"))}showAuthModal(){const e=document.getElementById("authModal");e&&(e.style.display="block")}closeAuthModal(){const e=document.getElementById("authModal");e&&(e.style.display="none")}async redirectToAdmin(){try{console.log("üîÑ Syncing user with backend at:",`${r.API_BASE_URL}/auth/login`);const e=await fetch(`${r.API_BASE_URL}/auth/login`,{method:"POST",headers:this.getAuthHeaders()});if(e.ok){const t=await e.json();console.log("‚úÖ User synced with backend:",t)}else{console.error("‚ùå Failed to sync user with backend. Status:",e.status);const t=await e.text();console.error("‚ùå Error response:",t)}}catch(e){console.error("‚ùå Error syncing with backend:",e),console.error("‚ùå API_BASE_URL:",r.API_BASE_URL)}this.showAdminDashboard()}showAdminDashboard(){const e=document.querySelector(".grid-container"),t=document.querySelector(".footer");e&&(e.style.display="none"),t&&(t.style.display="none");const n=document.getElementById("adminDashboard");n&&(n.style.display="block",this.fetchUserGames())}async fetchUserGames(){try{const e=await fetch(`${r.API_BASE_URL}/games`,{headers:this.getAuthHeaders()});if(e.ok){const t=await e.json();this.renderGamesList(t)}}catch(e){console.error("Failed to fetch games:",e)}}renderGamesList(e){const t=document.getElementById("gamesList"),n=document.getElementById("emptyState");if(!(!t||!n)){if(e.length===0){t.style.display="none",n.style.display="block";return}n.style.display="none",t.style.display="grid",t.innerHTML="",e.forEach(o=>{const s=document.createElement("div");s.className="game-card";const i=new Date(o.updatedAt).toLocaleDateString(),a=`${window.location.origin}/play/${o.id}`;s.innerHTML=`
                <h3>${o.name}</h3>
                <p class="game-meta">Updated: ${i}</p>
                <div class="game-actions">
                    <a href="${a}" class="btn btn-sm btn-primary">Play</a>
                    <button type="button" class="btn btn-sm btn-outline" onclick="event.preventDefault(); navigator.clipboard.writeText('${a}').then(() => alert('Link copied!'))">Share</button>
                    <button type="button" class="btn btn-sm btn-outline" onclick="event.preventDefault(); window.bingoApp.authManager.showGameResults('${o.id}', '${o.name}')">Results</button>
                    <button type="button" class="btn btn-sm btn-danger" onclick="event.preventDefault(); window.bingoApp.authManager.deleteGame('${o.id}')">Delete</button>
                </div>
            `,t.appendChild(s)})}}async showGameResults(e,t){try{const n=await fetch(`${r.API_BASE_URL}/games/${e}/results`,{headers:this.getAuthHeaders()});if(n.ok){const o=await n.json();this.renderResultsModal(t,o)}else alert("Failed to fetch results")}catch(n){console.error("Error fetching results:",n),alert("Error fetching results")}}renderResultsModal(e,t){const n=document.createElement("div");n.className="modal",n.style.display="block",n.style.zIndex="2000";let o=`
            <div class="modal-content" style="max-width: 600px;">
                <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                <h2>Results: ${e}</h2>
                <div class="results-list" style="max-height: 400px; overflow-y: auto; margin-top: 20px;">
        `;t.length===0?o+="<p>No players yet.</p>":(o+=`
                <table style="width: 100%; border-collapse: collapse;">
                    <thead>
                        <tr style="border-bottom: 2px solid #eee; text-align: left;">
                            <th style="padding: 10px;">Player</th>
                            <th style="padding: 10px;">Status</th>
                            <th style="padding: 10px;">Completed At</th>
                        </tr>
                    </thead>
                    <tbody>
            `,t.forEach(s=>{const i=s.isCompleted?"‚úÖ Completed":"Playing",a=s.completedAt?new Date(s.completedAt).toLocaleString():"-";o+=`
                    <tr style="border-bottom: 1px solid #eee;">
                        <td style="padding: 10px;">${s.playerName||"Anonymous"}</td>
                        <td style="padding: 10px;">${i}</td>
                        <td style="padding: 10px;">${a}</td>
                    </tr>
                `}),o+=`
                    </tbody>
                </table>
            `),o+=`
                </div>
                <div style="margin-top: 20px; text-align: right;">
                    <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove()">Close</button>
                </div>
            </div>
        `,n.innerHTML=o,document.body.appendChild(n)}async deleteGame(e){if(confirm("Are you sure you want to delete this game?"))try{(await fetch(`${r.API_BASE_URL}/games/${e}`,{method:"DELETE",headers:this.getAuthHeaders()})).ok?this.fetchUserGames():alert("Failed to delete game")}catch(t){console.error("Error deleting game:",t),alert("Error deleting game")}}hideAdminDashboard(){const e=document.querySelector(".grid-container"),t=document.querySelector(".footer");e&&(e.style.display="block"),t&&(t.style.display="block");const n=document.getElementById("adminDashboard");n&&(n.style.display="none")}showError(e){const t=document.getElementById("status");t&&(t.textContent=e,t.className="status error",t.style.display="block",setTimeout(()=>{t.style.display="none"},5e3))}getUser(){return this.user}isLoggedIn(){return this.isAuthenticated}getAuthHeaders(){var e;return this.isAuthenticated&&((e=this.user)!=null&&e.token)?{Authorization:`Bearer ${this.user.token}`}:{}}}export{f as A,r as C,m as g};

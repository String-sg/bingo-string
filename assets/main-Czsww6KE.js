(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const s of o)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(o){const s={};return o.integrity&&(s.integrity=o.integrity),o.referrerPolicy&&(s.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?s.credentials="include":o.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(o){if(o.ep)return;o.ep=!0;const s=t(o);fetch(o.href,s)}})();const y={BASE_URL:"./",DEV:!1,MODE:"production",PROD:!0,SSR:!1};class w{constructor(){this.config=this.getDefaultConfig(),this.loaded=!1}getDefaultConfig(){return{GOOGLE_CLIENT_ID:void 0,API_BASE_URL:"http://localhost:3000/api",ENVIRONMENT:"development",DEBUG_MODE:!0,LOG_LEVEL:"debug"}}detectEnvironment(){if(typeof window>"u")return"development";const e=window.location.hostname;return e.includes("staging")?"staging":e==="bingo.string.sg"?"production":"development"}async loadConfig(){if(this.loaded)return this.config;try{const e=this.detectEnvironment();if(console.log(`🔧 Detected environment: ${e}`),e==="development"){const o=(s,a=void 0)=>typeof import.meta<"u"&&y&&y[s]||a;return this.config={...this.config,GOOGLE_CLIENT_ID:o("VITE_GOOGLE_CLIENT_ID"),API_BASE_URL:o("VITE_API_BASE_URL","http://localhost:3000/api"),ENVIRONMENT:"development"},this.loaded=!0,console.log("✅ Using development configuration"),this.config}console.log(`🔧 Fetching config for ${e}...`);const t=await fetch(`/config-${e}.json`);if(!t.ok)throw new Error(`Failed to load config for ${e}: ${t.status}`);const n=await t.json();console.log("📋 Runtime config loaded:",n),this.config={...this.config,GOOGLE_CLIENT_ID:n.googleClientId,API_BASE_URL:n.apiBaseUrl,ENVIRONMENT:n.environment,DEBUG_MODE:n.debugMode,LOG_LEVEL:n.logLevel},this.loaded=!0,console.log(`✅ Loaded ${e} configuration`)}catch(e){console.warn("⚠️ Failed to load runtime config, using defaults:",e)}return this.config}get(e){return this.config[e]}}const I=new w,E=()=>I.loadConfig(),r={get GOOGLE_CLIENT_ID(){return I.get("GOOGLE_CLIENT_ID")},get API_BASE_URL(){return I.get("API_BASE_URL")},SESSION_TIMEOUT:24*60*60*1e3,CAMERA:{width:{ideal:1280},height:{ideal:720},facingMode:"environment"},ZOOM:{min:.5,max:3,step:.1},GRID:{size:5,centerIndex:12},ANIMATION:{fast:200,medium:300,slow:500},CHALLENGE_FILE:"2025_910samsung_bingo_challenges.csv"};class v{constructor(){this.challenges=[]}async loadChallenges(){try{const e=await fetch(r.CHALLENGE_FILE);if(!e.ok)throw new Error(`Failed to load challenges: ${e.status}`);const t=await e.text();return this.challenges=this.parseCSV(t),this.challenges.length!==25&&console.warn(`Expected 25 challenges, got ${this.challenges.length}`),this.challenges}catch(e){throw console.error("Error loading challenges:",e),e}}parseCSV(e){const t=e.trim().split(`
`),n=[],o=1;for(let s=o;s<t.length;s++){const a=t[s].trim();if(a){const i=this.parseCSVLine(a);i&&n.push(i)}}return n}parseCSVLine(e){const t=[];let n="",o=!1;for(let s=0;s<e.length;s++){const a=e[s];a==='"'?o=!o:a===","&&!o?(t.push(n.trim()),n=""):n+=a}return t.push(n.trim()),t.length>=2?{id:t[0],text:t[1]}:null}getChallenge(e){return e>=0&&e<this.challenges.length?this.challenges[e]:null}getAllChallenges(){return this.challenges}}class b{constructor(e,t){this.container=e,this.challengeLoader=t,this.cells=[],this.completedCells=new Set,this.bingoLines=[]}async createGrid(){const e=await this.challengeLoader.loadChallenges();this.container.innerHTML="",this.cells=[];for(let t=0;t<r.GRID.size*r.GRID.size;t++){const n=this.createCell(t,e[t]);this.container.appendChild(n),this.cells.push(n)}}createCell(e,t){const n=document.createElement("div");n.className="bingo-cell",n.dataset.index=e,e===r.GRID.centerIndex&&n.classList.add("center-cell");const o=document.createElement("div");o.className="cell-number",o.textContent=e+1;const s=document.createElement("div");return s.className="cell-text",s.textContent=t?t.text:"Free Space",n.appendChild(o),n.appendChild(s),n}setCellCompleted(e){e>=0&&e<this.cells.length&&(this.cells[e].classList.add("completed"),this.completedCells.add(e),this.checkForBingo())}setCellIncomplete(e){e>=0&&e<this.cells.length&&(this.cells[e].classList.remove("completed"),this.cells[e].style.backgroundImage="",this.completedCells.delete(e),this.removeBingoHighlight())}checkForBingo(){const e=this.getBingoLines();for(const t of e)if(t.every(n=>this.completedCells.has(n)))return this.highlightBingoLine(t),!0;return!1}getBingoLines(){const e=[];for(let o=0;o<r.GRID.size;o++){const s=[];for(let a=0;a<r.GRID.size;a++)s.push(o*r.GRID.size+a);e.push(s)}for(let o=0;o<r.GRID.size;o++){const s=[];for(let a=0;a<r.GRID.size;a++)s.push(a*r.GRID.size+o);e.push(s)}const t=[],n=[];for(let o=0;o<r.GRID.size;o++)t.push(o*r.GRID.size+o),n.push(o*r.GRID.size+(r.GRID.size-1-o));return e.push(t,n),e}highlightBingoLine(e){this.bingoLines.push(e);for(const t of e)t>=0&&t<this.cells.length&&this.cells[t].classList.add("bingo-line")}removeBingoHighlight(){for(const e of this.bingoLines)for(const t of e)t>=0&&t<this.cells.length&&this.cells[t].classList.remove("bingo-line");this.bingoLines=[]}getCompletedCells(){return Array.from(this.completedCells)}reset(){this.completedCells.clear(),this.bingoLines=[];for(const e of this.cells)e.classList.remove("completed","bingo-line")}}class M{constructor(){this.stream=null,this.videoElement=null,this.currentFacingMode="environment"}async startCamera(e){this.videoElement=e;try{const t={video:{...r.CAMERA,facingMode:this.currentFacingMode}};return this.stream=await navigator.mediaDevices.getUserMedia(t),this.videoElement.srcObject=this.stream,!0}catch(t){throw console.error("Error starting camera:",t),t}}async switchCamera(){this.stream&&(this.currentFacingMode=this.currentFacingMode==="environment"?"user":"environment",this.stopCamera(),await this.startCamera(this.videoElement))}capturePhoto(){if(!this.videoElement||!this.stream)throw new Error("Camera not started");const e=document.createElement("canvas"),t=e.getContext("2d");return e.width=this.videoElement.videoWidth,e.height=this.videoElement.videoHeight,t.drawImage(this.videoElement,0,0),e.toDataURL("image/jpeg",.8)}stopCamera(){this.stream&&(this.stream.getTracks().forEach(e=>e.stop()),this.stream=null),this.videoElement&&(this.videoElement.srcObject=null)}handleFileUpload(e){return new Promise((t,n)=>{const o=new FileReader;o.onload=s=>{const a=s.target.result;t(a)},o.onerror=()=>{n(new Error("Failed to read file"))},o.readAsDataURL(e)})}resizeImage(e,t=800,n=600){return new Promise(o=>{const s=new Image;s.onload=()=>{const a=document.createElement("canvas"),i=a.getContext("2d");let{width:l,height:c}=s;l>c?l>t&&(c=c*t/l,l=t):c>n&&(l=l*n/c,c=n),a.width=l,a.height=c,i.drawImage(s,0,0,l,c),o(a.toDataURL("image/jpeg",.8))},s.src=e})}}class L{constructor(e){this.gridContainer=e,this.grid=e.querySelector(".bingo-grid"),this.scale=1,this.translateX=0,this.translateY=0,this.isDragging=!1,this.lastTouchDistance=0,this.lastTouchCenter={x:0,y:0},this.initTouchEvents()}initTouchEvents(){this.gridContainer.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!1}),this.gridContainer.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),this.gridContainer.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!1})}handleTouchStart(e){e.touches.length===1?(this.isDragging=!0,this.lastTouchCenter={x:e.touches[0].clientX,y:e.touches[0].clientY}):e.touches.length===2&&(this.isDragging=!1,this.lastTouchDistance=this.getTouchDistance(e.touches[0],e.touches[1]),this.lastTouchCenter=this.getTouchCenter(e.touches[0],e.touches[1]))}handleTouchMove(e){if(e.preventDefault(),e.touches.length===1&&this.isDragging){const t=e.touches[0],n=t.clientX-this.lastTouchCenter.x,o=t.clientY-this.lastTouchCenter.y;this.translateX+=n,this.translateY+=o,this.lastTouchCenter={x:t.clientX,y:t.clientY},this.updateTransform()}else if(e.touches.length===2){const t=this.getTouchDistance(e.touches[0],e.touches[1]),n=this.getTouchCenter(e.touches[0],e.touches[1]),o=t/this.lastTouchDistance,s=Math.max(r.ZOOM.min,Math.min(r.ZOOM.max,this.scale*o)),a=s/this.scale,i=(n.x-this.lastTouchCenter.x)*(1-a),l=(n.y-this.lastTouchCenter.y)*(1-a);this.scale=s,this.translateX+=i,this.translateY+=l,this.lastTouchDistance=t,this.lastTouchCenter=n,this.updateTransform()}}handleTouchEnd(e){this.isDragging=!1}getTouchDistance(e,t){const n=e.clientX-t.clientX,o=e.clientY-t.clientY;return Math.sqrt(n*n+o*o)}getTouchCenter(e,t){return{x:(e.clientX+t.clientX)/2,y:(e.clientY+t.clientY)/2}}updateTransform(){this.grid.style.transform=`translate(${this.translateX}px, ${this.translateY}px) scale(${this.scale})`}reset(){this.scale=1,this.translateX=0,this.translateY=0,this.updateTransform()}}class B{constructor(e){this.cameraManager=e,this.currentCellIndex=null,this.currentImageData=null,this.initModals()}initModals(){this.optionsModal=document.getElementById("optionsModal"),this.cameraModal=document.getElementById("cameraModal"),this.previewModal=document.getElementById("previewModal"),this.bingoModal=document.getElementById("bingoModal"),document.querySelectorAll(".close").forEach(e=>{e.addEventListener("click",()=>this.closeModal())}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",t=>{t.target===e&&this.closeModal()})})}showModal(e){const t=document.getElementById(e);t&&(t.style.display="block")}closeModal(){document.querySelectorAll(".modal").forEach(e=>{e.style.display="none"}),this.cameraModal.style.display==="none"&&this.cameraManager.stopCamera()}showOptionsModal(e){this.currentCellIndex=e,this.showModal("optionsModal")}async showCameraModal(e=null){e!==null&&(this.currentCellIndex=e),this.showModal("cameraModal");const t=document.getElementById("video");try{await this.cameraManager.startCamera(t)}catch(n){console.error("Failed to start camera:",n),this.showStatus("Camera access denied. Please use file upload instead.","error")}}async handleFileUpload(e){try{this.currentImageData=await this.cameraManager.handleFileUpload(e),this.currentImageData=await this.cameraManager.resizeImage(this.currentImageData),this.confirmImage()}catch(t){console.error("File upload error:",t),this.showStatus("Failed to upload file. Please try again.","error")}}async capturePhoto(){try{this.currentImageData=this.cameraManager.capturePhoto(),this.currentImageData=await this.cameraManager.resizeImage(this.currentImageData),this.confirmImage()}catch(e){console.error("Photo capture error:",e),this.showStatus("Failed to capture photo. Please try again.","error")}}confirmImage(){this.closeModal(),window.bingoApp&&window.bingoApp.handleImageConfirm()}deleteImage(){this.currentImageData=null,this.closeModal()}submitBingo(){this.closeModal(),this.showBingoCelebration()}showBingoCelebration(){this.showModal("bingoModal")}showStatus(e,t="success"){const n=document.querySelector(".status");n&&(n.textContent=e,n.className=`status ${t}`,n.style.display="block",setTimeout(()=>{this.hideStatus()},3e3))}hideStatus(){const e=document.querySelector(".status");e&&(e.style.display="none")}updateSubmitButton(e){const t=document.getElementById("submitBtn");t&&(t.disabled=!e,t.textContent=e?"Submit Bingo!":"Please fill all fields")}getCurrentCellIndex(){return this.currentCellIndex}getCurrentImageData(){return this.currentImageData}clearCurrentData(){this.currentCellIndex=null,this.currentImageData=null}}class S{constructor(){this.user=null,this.isAuthenticated=!1,this.googleAuth=null,this.clientId=null,this.init()}async init(){try{console.log("🔧 AuthManager: Loading configuration...");const e=await E();this.clientId=e.GOOGLE_CLIENT_ID,console.log("🔧 AuthManager: Client ID loaded:",this.clientId),await this.waitForGoogleAuth(),await this.initializeGoogleAuth(),this.loadStoredSession()}catch(e){console.error("Failed to initialize auth:",e)}}waitForGoogleAuth(){return new Promise((e,t)=>{var a,i;if((i=(a=window.google)==null?void 0:a.accounts)!=null&&i.id){e();return}let n=0;const o=50,s=()=>{var l,c;n++,(c=(l=window.google)==null?void 0:l.accounts)!=null&&c.id?e():n>=o?t(new Error("Google Identity Services failed to load")):setTimeout(s,100)};s()})}async initializeGoogleAuth(){if(console.log("🔧 Initializing Google Auth with Client ID:",this.clientId),!this.clientId||this.clientId==="YOUR_GOOGLE_CLIENT_ID_HERE"){console.error("❌ Google Client ID not configured. Current value:",this.clientId),console.error("❌ CONFIG object:",r);return}window.google.accounts.id.initialize({client_id:this.clientId,callback:this.handleGoogleResponse.bind(this),auto_select:!1,cancel_on_tap_outside:!0}),this.renderSignInButton()}renderSignInButton(){const e=document.getElementById("googleSignInBtn");e&&window.google.accounts.id.renderButton(e,{theme:"outline",size:"large",text:"signin_with",width:300})}handleGoogleResponse(e){try{const t=this.parseJWT(e.credential);this.user={id:t.sub,email:t.email,name:t.name,picture:t.picture,token:e.credential},this.isAuthenticated=!0,this.storeSession(),this.updateUI(),this.closeAuthModal(),this.redirectToAdmin(),typeof gtag<"u"&&gtag("event","login",{event_category:"engagement",event_label:"google_oauth",value:1})}catch(t){console.error("Failed to handle Google response:",t),this.showError("Login failed. Please try again.")}}parseJWT(e){try{const n=e.split(".")[1].replace(/-/g,"+").replace(/_/g,"/"),o=decodeURIComponent(atob(n).split("").map(function(s){return"%"+("00"+s.charCodeAt(0).toString(16)).slice(-2)}).join(""));return JSON.parse(o)}catch{throw new Error("Invalid token format")}}storeSession(){this.user&&localStorage.setItem("bingoAuth",JSON.stringify({user:this.user,timestamp:Date.now()}))}loadStoredSession(){try{const e=localStorage.getItem("bingoAuth");if(e){const t=JSON.parse(e);Date.now()-t.timestamp<r.SESSION_TIMEOUT?(this.user=t.user,this.isAuthenticated=!0,this.updateUI()):this.logout()}}catch(e){console.error("Failed to load stored session:",e),this.logout()}}logout(){this.user=null,this.isAuthenticated=!1,localStorage.removeItem("bingoAuth"),this.updateUI(),typeof gtag<"u"&&gtag("event","logout",{event_category:"engagement",event_label:"manual",value:1})}updateUI(){const e=document.getElementById("authBtn"),t=document.getElementById("makeYourOwnBtn"),n=document.getElementById("userInfo"),o=document.getElementById("userName"),s=document.getElementById("userAvatar");this.isAuthenticated&&this.user?(e&&(e.style.display="none"),t&&(t.style.display="inline-block"),n&&(n.style.display="block"),o&&(o.textContent=this.user.name),s&&(s.src=this.user.picture)):(e&&(e.style.display="inline-block"),t&&(t.style.display="none"),n&&(n.style.display="none"))}showAuthModal(){const e=document.getElementById("authModal");e&&(e.style.display="block")}closeAuthModal(){const e=document.getElementById("authModal");e&&(e.style.display="none")}async redirectToAdmin(){try{const e=await fetch(`${r.API_BASE_URL}/auth/login`,{method:"POST",headers:this.getAuthHeaders()});if(e.ok){const t=await e.json();console.log("User synced with backend:",t)}else console.warn("Failed to sync user with backend")}catch(e){console.warn("Error syncing with backend:",e)}this.showAdminDashboard()}showAdminDashboard(){const e=document.querySelector(".grid-container"),t=document.querySelector(".footer");e&&(e.style.display="none"),t&&(t.style.display="none");const n=document.getElementById("adminDashboard");n&&(n.style.display="block")}hideAdminDashboard(){const e=document.querySelector(".grid-container"),t=document.querySelector(".footer");e&&(e.style.display="block"),t&&(t.style.display="block");const n=document.getElementById("adminDashboard");n&&(n.style.display="none")}showError(e){const t=document.getElementById("status");t&&(t.textContent=e,t.className="status error",t.style.display="block",setTimeout(()=>{t.style.display="none"},5e3))}getUser(){return this.user}isLoggedIn(){return this.isAuthenticated}getAuthHeaders(){var e;return this.isAuthenticated&&((e=this.user)!=null&&e.token)?{Authorization:`Bearer ${this.user.token}`}:{}}}class D{constructor(){this.challengeLoader=new v,this.bingoGrid=null,this.cameraManager=new M,this.touchManager=null,this.modalManager=new B(this.cameraManager),this.authManager=new S,this.init()}async init(){try{console.log("🔧 Loading configuration...");const e=await E();console.log("🔧 Configuration loaded:",e),console.log("🔧 Google Client ID from config:",e.GOOGLE_CLIENT_ID),await this.setupGrid(),this.setupEventListeners(),this.setupTouchManager(),this.loadCellImages()}catch(e){console.error("Failed to initialize app:",e),this.showError("Failed to load the game. Please refresh the page.")}}async setupGrid(){const e=document.querySelector(".bingo-grid");if(!e)throw new Error("Bingo grid container not found");this.bingoGrid=new b(e,this.challengeLoader),await this.bingoGrid.createGrid()}setupEventListeners(){document.addEventListener("click",d=>{if(d.target.closest(".bingo-cell")){const f=d.target.closest(".bingo-cell"),C=parseInt(f.dataset.index);this.handleCellClick(C)}});const e=document.getElementById("switchCameraBtn");e&&e.addEventListener("click",()=>this.cameraManager.switchCamera());const t=document.getElementById("captureBtn");t&&t.addEventListener("click",()=>this.modalManager.capturePhoto());const n=document.getElementById("uploadBtn");n&&n.addEventListener("click",()=>{document.getElementById("cameraFileInput").click()});const o=document.getElementById("cameraFileInput");o&&o.addEventListener("change",d=>{const f=d.target.files[0];f&&this.modalManager.handleFileUpload(f)});const s=document.getElementById("celebrateBtn");s&&s.addEventListener("click",()=>this.modalManager.closeModal());const a=document.getElementById("resetBtn");a&&a.addEventListener("click",()=>this.reset());const i=document.getElementById("downloadBtn");i&&i.addEventListener("click",()=>this.downloadAllImages());const l=document.getElementById("authBtn");l&&l.addEventListener("click",()=>this.authManager.showAuthModal());const c=document.getElementById("makeYourOwnBtn");c&&c.addEventListener("click",()=>this.authManager.redirectToAdmin());const g=document.getElementById("logoutBtn");g&&g.addEventListener("click",()=>this.authManager.logout()),document.addEventListener("click",d=>{d.target.classList.contains("close")&&d.target.closest("#authModal")&&this.authManager.closeAuthModal(),d.target.id==="authModal"&&this.authManager.closeAuthModal()});const u=document.getElementById("backToGameBtn");u&&u.addEventListener("click",()=>this.authManager.hideAdminDashboard());const m=document.getElementById("createNewGameBtn"),p=document.getElementById("createNewGameBtn2");m&&m.addEventListener("click",()=>this.handleCreateNewGame()),p&&p.addEventListener("click",()=>this.handleCreateNewGame())}setupTouchManager(){const e=document.querySelector(".grid-container");e&&(this.touchManager=new L(e))}handleCellClick(e){this.bingoGrid.cells[e].classList.contains("completed")?this.showPhotoModal(e):this.modalManager.showCameraModal(e)}handleImageConfirm(){const e=this.modalManager.getCurrentCellIndex(),t=this.modalManager.getCurrentImageData();e!==null&&t&&(this.bingoGrid.setCellCompleted(e),this.storeCellImage(e,t),this.modalManager.closeModal(),this.modalManager.clearCurrentData(),this.bingoGrid.checkForBingo()&&this.handleBingo())}storeCellImage(e,t){const n=JSON.parse(localStorage.getItem("bingoCellImages")||"{}");n[e]=t,localStorage.setItem("bingoCellImages",JSON.stringify(n));const o=this.bingoGrid.cells[e];o&&(o.style.backgroundImage=`url(${t})`,o.style.backgroundSize="cover",o.style.backgroundPosition="center",o.classList.add("has-image")),typeof gtag<"u"&&gtag("event","photo_taken",{event_category:"engagement",event_label:`cell_${e}`,value:1})}loadCellImages(){const e=JSON.parse(localStorage.getItem("bingoCellImages")||"{}");Object.entries(e).forEach(([t,n])=>{const o=parseInt(t),s=this.bingoGrid.cells[o];s&&(s.style.backgroundImage=`url(${n})`,s.style.backgroundSize="cover",s.style.backgroundPosition="center",s.classList.add("has-image"))})}showPhotoModal(e){const n=JSON.parse(localStorage.getItem("bingoCellImages")||"{}")[e];if(n){const o=document.createElement("div");o.className="modal",o.style.display="block";const s=this.challengeLoader.getChallenge(e),a=s?s.text:`Challenge ${e+1}`;o.innerHTML=`
                <div class="modal-content">
                    <span class="close" onclick="this.parentElement.parentElement.remove()">&times;</span>
                    <h2>${a}</h2>
                    <div class="preview-container">
                        <img src="${n}" class="preview-image" alt="Challenge proof">
                    </div>
                    <div style="margin-top: 20px; text-align: center;">
                        <button class="btn btn-secondary" onclick="this.parentElement.parentElement.parentElement.remove()">Close</button>
                        <button class="btn btn-danger" onclick="window.bingoApp.removeCellImage(${e})">Remove Photo</button>
                    </div>
                </div>
            `,document.body.appendChild(o),o.addEventListener("click",i=>{i.target===o&&o.remove()})}}removeCellImage(e){const t=JSON.parse(localStorage.getItem("bingoCellImages")||"{}");delete t[e],localStorage.setItem("bingoCellImages",JSON.stringify(t));const n=this.bingoGrid.cells[e];n&&(n.style.backgroundImage="",n.classList.remove("has-image")),this.bingoGrid.setCellIncomplete(e),document.querySelector(".modal").remove()}handleBingo(){this.modalManager.showBingoCelebration()}reset(){localStorage.removeItem("bingoCellImages"),this.bingoGrid.reset(),this.touchManager&&this.touchManager.reset(),this.modalManager.closeModal(),this.modalManager.clearCurrentData(),this.bingoGrid.cells.forEach(e=>{e.style.backgroundImage="",e.classList.remove("has-image")})}showError(e){const t=document.createElement("div");t.className="error",t.textContent=e;const n=document.querySelector(".grid-container");n&&n.parentNode.insertBefore(t,n)}getStatus(){const e=this.bingoGrid.getCompletedCells();return{completed:e.length,total:25,percentage:Math.round(e.length/25*100)}}async downloadAllImages(){const e=JSON.parse(localStorage.getItem("bingoCellImages")||"{}"),t=Object.entries(e);if(t.length===0){alert("No images to download. Complete some challenges first!");return}if(t.length===1){const[n,o]=t[0],s=this.challengeLoader.getChallenge(parseInt(n)),a=s?s.text:`Challenge ${parseInt(n)+1}`;this.downloadSingleImage(o,`bingo-${parseInt(n)+1}-${a.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.png`),typeof gtag<"u"&&gtag("event","download_images",{event_category:"engagement",event_label:"single_image",value:1});return}try{const n=await this.loadJSZip(),o=new n;for(const[l,c]of t){const g=this.challengeLoader.getChallenge(parseInt(l)),u=g?g.text:`Challenge ${parseInt(l)+1}`,m=`bingo-${parseInt(l)+1}-${u.replace(/[^a-z0-9]/gi,"_").toLowerCase()}.png`,d=await(await fetch(c)).blob();o.file(m,d)}const s=await o.generateAsync({type:"blob"}),a=URL.createObjectURL(s),i=document.createElement("a");i.href=a,i.download="bingo-images.zip",document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(a),typeof gtag<"u"&&gtag("event","download_images",{event_category:"engagement",event_label:"zip_file",value:t.length})}catch(n){console.error("Error downloading images:",n),alert("Error downloading images. Please try again.")}}downloadSingleImage(e,t){const n=document.createElement("a");n.href=e,n.download=t,document.body.appendChild(n),n.click(),document.body.removeChild(n)}async loadJSZip(){return window.JSZip?window.JSZip:new Promise((e,t)=>{const n=document.createElement("script");n.src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js",n.onload=()=>e(window.JSZip),n.onerror=()=>t(new Error("Failed to load JSZip")),document.head.appendChild(n)})}handleCreateNewGame(){window.location.href="/new.html",typeof gtag<"u"&&gtag("event","create_game_intent",{event_category:"engagement",event_label:"admin_dashboard",value:1})}}document.addEventListener("DOMContentLoaded",()=>{window.bingoApp=new D});

import{A as m,g as h}from"./authManager-By_oS-D4.js";class p{constructor(){this.config=null,this.authManager=new m}async init(){try{console.log("ðŸ”§ Loading configuration for game creation..."),this.config=await h(),console.log("ðŸ”§ Configuration loaded:",this.config.ENVIRONMENT),console.log("ðŸ”§ Waiting for AuthManager..."),await this.authManager.init(),console.log("ðŸ”§ AuthManager initialized"),this.setupEventListeners(),this.initializeBingoEditor(),this.setupAnalytics()}catch(e){console.error("Failed to initialize game creation app:",e),this.showError("Failed to load the game creation page. Please refresh.")}}async setupAnalytics(){try{const e=this.config.GOOGLE_ANALYTICS_ID;if(e){let i=function(){dataLayer.push(arguments)};const t=document.createElement("script");t.async=!0,t.src=`https://www.googletagmanager.com/gtag/js?id=${e}`,document.head.appendChild(t),window.dataLayer=window.dataLayer||[],window.gtag=i,i("js",new Date),i("config",e),console.log("ðŸ“Š Google Analytics initialized")}}catch(e){console.warn("Failed to setup analytics:",e)}}setupEventListeners(){const e=document.getElementById("createGameBtn");e?(console.log("ðŸ”§ Attaching click listener to createGameBtn"),e.addEventListener("click",a=>{console.log("ðŸ–±ï¸ Create Game button clicked"),this.handleGameSubmit()})):console.error("âŒ createGameBtn not found in DOM");const t=document.getElementById("editQuestionsBtn");t&&t.addEventListener("click",()=>this.toggleEditMode());const i=document.getElementById("importCsvBtn");i&&i.addEventListener("click",()=>this.handleCsvImport());const o=document.getElementById("gameName");o&&o.focus(),document.querySelectorAll('input[name="gridSize"]').forEach(a=>{a.addEventListener("change",()=>this.initializeBingoEditor())})}initializeBingoEditor(){const e=document.getElementById("bingoEditorGrid");if(!e)return;const t=parseInt(document.querySelector('input[name="gridSize"]:checked').value),i=t*t;e.innerHTML="",e.style.gridTemplateColumns=`repeat(${t}, 1fr)`;for(let o=0;o<i;o++){const n=document.createElement("textarea");n.className="editor-cell",n.dataset.index=o,t===5&&o===12?(n.className+=" free-cell",n.value="FREE",n.disabled=!0,n.placeholder=""):(n.placeholder=`Q${o+1}`,n.maxLength=100),e.appendChild(n)}}async handleGameSubmit(){if(console.log("ðŸ“ Handling game submission..."),!this.authManager.isLoggedIn()){console.log("âš ï¸ User not logged in, showing auth modal"),this.authManager.showAuthModal();return}const e=document.getElementById("gameName"),t=e==null?void 0:e.value.trim();if(!t){alert("Please enter a game name"),e==null||e.focus();return}const i=parseInt(document.querySelector('input[name="gridSize"]:checked').value),o=[];document.querySelectorAll(".editor-cell").forEach((a,r)=>{let s="";i===5&&r===12?s="FREE":s=a.value.trim()||`Question ${r+1}`,o.push({id:`q${r}`,text:s})});try{const a=document.getElementById("createGameBtn");a&&(a.disabled=!0,a.textContent="Creating...");const r=await fetch(`${this.config.API_BASE_URL}/games`,{method:"POST",headers:{"Content-Type":"application/json",...this.authManager.getAuthHeaders()},body:JSON.stringify({name:t,challenges:o,gridSize:i,isPublic:!0})});if(!r.ok)throw new Error(`Failed to create game: ${r.status}`);const s=await r.json();console.log("Game created:",s);const l=`${window.location.origin}/play/${s.id}`;alert(`Game created successfully!

Share this link:
${l}`),typeof gtag<"u"&&gtag("event","game_created",{event_category:"engagement",event_label:"custom_game",value:1}),window.location.href=`/play/${s.id}`}catch(a){console.error("Error creating game:",a),this.showError("Failed to create game. Please try again.");const r=document.getElementById("createGameBtn");r&&(r.disabled=!1,r.textContent="Create Game")}}toggleEditMode(){alert("You can edit any cell by clicking directly in it.")}handleCsvImport(){const e=document.createElement("input");e.type="file",e.accept=".csv",e.style.display="none",e.addEventListener("change",t=>{const i=t.target.files[0];i&&this.importCsvFile(i)}),document.body.appendChild(e),e.click(),document.body.removeChild(e)}importCsvFile(e){const t=new FileReader;t.onload=i=>{try{const n=i.target.result.split(`
`).filter(l=>l.trim());if(n.length<24){alert("CSV file must contain at least 24 questions (excluding the center FREE cell)");return}const a=document.querySelectorAll(".editor-cell"),r=parseInt(document.querySelector('input[name="gridSize"]:checked').value);let s=0;n.length>0&&n[0].toLowerCase().includes("number")&&n[0].toLowerCase().includes("challenge")&&(console.log("Skipping CSV header row"),s=1),a.forEach((l,u)=>{if(!(r===5&&u===12)&&s<n.length){let c=n[s].trim();if(c.includes(",")){const d=c.split(",");isNaN(parseInt(d[0]))||(c=d.slice(1).join(",").trim())}l.value=c.replace(/"/g,""),s++}}),alert(`Successfully imported ${s} questions from CSV file!`)}catch(o){console.error("CSV import error:",o),alert("Error reading CSV file. Please make sure it's a valid CSV with one question per line.")}},t.readAsText(e)}getUserEmail(){var e;try{const t=localStorage.getItem("bingoAuth");if(t)return(e=JSON.parse(t).user)==null?void 0:e.email}catch{console.log("No auth session found")}return null}showError(e){const t=document.getElementById("status");t&&(t.textContent=e,t.className="status error",t.style.display="block",setTimeout(()=>{t.style.display="none"},5e3))}}document.addEventListener("DOMContentLoaded",()=>{new p().init()});
